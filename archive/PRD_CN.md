# 产品需求文档（PRD）
# 6SPC 智能质量分析系统

**文档版本**：v1.0
**创建日期**：2025-02-22
**产品阶段**：MVP
**目标受众**：产品经理、开发团队、质量工程师

---

## 1. 文档信息

| 字段 | 内容 |
|-----|------|
| 产品名称 | 6SPC 智能质量分析系统 |
| 产品代号 | 6SPC-Pro-Max |
| 所属行业 | 医疗器械制造（塑料注射部件） |
| 合规标准 | ISO 13485:2016、FDA 21 CFR 820、EMA MDR/IVDR |
| 核心价值 | 将手写 QC 检验记录自动数字化为合规的统计过程控制报告 |

---

## 2. 产品背景

### 2.1 行业痛点

**当前流程的问题**：
- **效率低下**：质量工程师每天花费 2-3 小时手动录入检验数据
- **易出错**：手动键盘输入错误率高达 3-5%，影响产品质量判断
- **合规风险**：纸质记录难以追溯，不符合 ISO 13485 电子记录要求
- **分析延迟**：数据无法实时统计，质量问题发现滞后

**目标用户场景**：
```
质量工程师收到 50 份原材料进货检验记录（手写扫描件）
→ 需要在 2 小时内完成数据录入和 6SPC 分析
→ 生成合规的 IQC 统计报告（包含 Cp/Cpk/Pp/Ppk）
→ 报告需经主管审核后存档（10 年保留期）
```

### 2.2 市场机会

- **市场规模**：中国医疗器械制造商 20,000+ 家，普遍存在类似痛点
- **数字化转型**：90% 的企业仍在使用纸质/Excel 方式管理质量数据
- **监管压力**：NMPA（中国药监局）加强电子记录合规性审查

---

## 3. 产品目标

### 3.1 核心目标（MVP）

**目标 1：效率提升**
- 将 50 份检验记录的处理时间从 **2 小时** 缩短至 **15 分钟**（8x 效率提升）

**目标 2：错误率降低**
- 数据录入错误率从 **3-5%** 降低至 **<0.5%**（通过 AI 识别 + 人工验证）

**目标 3：合规性**
- 生成的报告符合 **ISO 13485** 电子记录要求
- 支持 **FDA 21 CFR Part 11** 电子签名标准（V2 功能）

### 3.2 成功指标

| 指标 | 基线 | 目标 | 测量方式 |
|-----|------|------|---------|
| 单批次处理时间 | 120 分钟 | 15 分钟 | 系统计时 |
| 数据错误率 | 3-5% | <0.5% | 人工抽检 10% |
| 用户满意度 | N/A | ≥4.0/5.0 | NPS 问卷调查 |
| 日处理批次量 | 10 批次 | 50+ 批次 | 系统日志 |

---

## 4. 用户画像

### 4.1 主要用户：质量工程师（质量部 QC）

**基本信息**：
- 年龄：25-40 岁
- 学历：大专/本科（机械、材料、质量管理专业）
- 工作经验：2-10 年
- 工具使用：Excel、Word、ERP 系统

**核心需求**：
- 快速完成日常数据录入和统计计算
- 确保统计计算的正确性（Cp/Cpk 不能算错）
- 生成美观、合规的报告供主管审核

**痛点**：
- "每天重复录入数据太枯燥，容易出错"
- "Excel 公式经常被误删，不知道结果对不对"
- "主管说报告格式不统一，返工很烦"

**技术能力**：中等（会使用办公软件，但不是程序员）

### 4.2 次要用户：质量主管

**基本信息**：
- 年龄：30-50 岁
- 职责：审核质量报告、决策放行/拒收

**核心需求**：
- 快速判断批次是否合格（Cpk ≥ 1.33）
- 识别异常趋势（工具磨损、供应商质量波动）
- 合规性审查（数据完整性、可追溯性）

---

## 5. 用户故事

### Epic 1：智能 OCR 识别

**US-1.1 上传扫描件**
- **作为**质量工程师
- **我想要**拖拽上传 PDF/JPG 检验记录
- **以便**启动自动化数据处理流程

**验收标准**：
- 支持拖拽上传
- 支持文件格式：PDF、JPG、PNG
- 显示上传进度和文件预览
- 文件大小限制：<10MB

---

**US-1.2 AI 自动提取数据**
- **作为**质量工程师
- **我想要**系统自动识别表格中的测量数据
- **以便**减少手动录入工作量

**验收标准**：
- 自动识别批次号、零件名称、规格限（USL/LSL）
- 自动提取所有测量数值（目标识别率 >90%）
- 显示识别进度（"AI 正在处理..."）
- 识别完成时长 <30 秒（50 个数据点）

---

**US-1.3 智能修正 OCR 错误**
- **作为**质量工程师
- **我想要**系统自动修正常见识别错误
- **以便**减少我的校对工作

**验收标准**：
- 自动修正缺失小数点：`102` → `10.2`（根据 USL 推断）
- 自动剥离单位：`10.1mm` → `10.1`
- 自动替形似字符：`O` → `0`，`l` → `1`
- 高亮显示可疑值（超出 ±3σ）

---

### Epic 2：交互式验证

**US-2.1 数据编辑器**
- **作为**质量工程师
- **我想要**在表格中直接编辑数据
- **以便**修正 OCR 错误或补充漏测数据

**验收标准**：
- 类似 Excel 的可编辑表格
- 支持添加/删除行
- 编辑后自动重新计算统计量
- 支持撤销/重做

---

**US-2.2 实时统计预览**
- **作为**质量工程师
- **我想要**编辑数据时实时看到 Cpk 变化
- **以便**快速判断数据是否合理

**验收标准**：
- 修改数据后 <1 秒更新 Cpk/Pp/Cp/Ppk
- 高亮显示不合格指标（红色）
- 显示均值、标准差、最大值、最小值

---

**US-2.3 完整性检查**
- **作为**质量工程师
- **我想要**系统提醒我数据是否完整
- **以便**避免遗漏测量点

**验收标准**：
- 显示预期数据点数（如 n=50）
- 实际点数 <80% 时显示 ⚠️ 警告
- 高亮显示空行或无效值

---

### Epic 3：6 SPC 可视化分析

**US-3.1 三图基础分析（MVP）**
- **作为**质量工程师
- **我想要**查看单值图、X-bar 图、R-图
- **以便**快速判断过程稳定性

**验收标准**：
- **单值图**：显示所有数据点、USL/LSL 线
- **X-bar 图**：显示子组均值（n=5）、控制限（UCL/LCL）
- **R-图**：显示子组极差
- 图表交互：鼠标悬停显示数值、可缩放

---

**US-3.2 完整 6 SPC 分析（V2）**
- **作为**质量工程师
- **我想要**查看直方图、正态概率图、能力图
- **以便**进行完整的统计分析

**验收标准**：
- **直方图**：频数分布 + 正态拟合曲线
- **正态概率图**：Q-Q 图检验正态性
- **能力图**：正态分布曲线 + 规格限 + Cp/Cpk 显示
- 支持"快速查看"（3 图）vs"完整分析"（6 图）切换

---

**US-3.3 图表导出**
- **作为**质量工程师
- **我想要**导出图表为图片
- **以便**在 Word/PPT 中使用

**验收标准**：
- 支持导出格式：PNG、SVG
- 支持单图表导出或全部导出
- 导出分辨率 ≥300 DPI（用于打印）

---

### Epic 4：报告生成

**US-4.1 HTML 报告预览（MVP）**
- **作为**质量工程师
- **我想要**预览最终报告
- **以便**确认内容无误后生成正式报告

**验收标准**：
- 报告包含：批次信息、数据表格、统计摘要、6 个图表
- 响应式布局，支持打印预览（Ctrl+P）
- 显示报告生成时间和唯一编号

---

**US-4.2 PDF 报告导出（V2）**
- **作为**质量工程师
- **我想要**导出 PDF 格式的正式报告
- **以便**存档和发送邮件

**验收标准**：
- PDF 格式符合 FDA 21 CFR Part 11 要求
- 包含电子签名区域
- PDF 文件大小 <2MB
- 文件命名规则：`批次号_6SPC报告_日期.pdf`

---

**US-4.3 报告模板管理**
- **作为**质量主管
- **我想要**自定义报告模板
- **以便**符合公司品牌规范

**验收标准**：
- 支持上传公司 Logo
- 自定义报告标题和页脚
- 保存多个模板（如"IQC 模板"、"IPQC 模板"）

---

### Epic 5：数据管理

**US-5.1 历史记录查询**
- **作为**质量工程师
- **我想要**按批次号或日期查询历史报告
- **以便**快速参考之前的分析结果

**验收标准**：
- 支持按批次号、日期范围、零件名称搜索
- 显示报告列表（批次号、日期、Cpk 状态）
- 点击可查看历史报告详情

---

**US-5.2 数据导出**
- **作为**质量工程师
- **我想要**导出原始数据为 Excel
- **以便**进一步分析或存档

**验收标准**：
- 导出格式：.xlsx（带格式）
- 包含所有原始测量数据
- 包含计算得到的统计量

---

## 6. 功能结构

### 6.1 功能优先级（MoSCoW）

| 优先级 | 功能模块 | 说明 |
|-------|---------|------|
| **Must Have** | OCR 数据提取 | 核心功能，必须实现 |
| **Must Have** | 交互式数据编辑器 | 人工验证必需 |
| **Must Have** | Cpk/Cp/Pp/Ppk 计算 | 统计核心 |
| **Must Have** | 3 图基础分析 | 单值图 + X-bar + R-图 |
| **Must Have** | HTML 报告预览 | MVP 阶段不生成 PDF |
| **Should Have** | 异常值检测（3σ） | 提升用户体验 |
| **Should Have** | OCR 智能修正 | 减少人工编辑 |
| **Should Have** | 实时正态性检验 | 统计正确性保障 |
| **Could Have** | 完整 6 SPC 图表 | 高级分析需求 |
| **Could Have** | 历史记录查询 | 便捷性功能 |
| **Won't Have** | PDF 导出 | V2 功能（MVP 仅 HTML） |
| **Won't Have** | 电子签名 | V2 功能（需认证集成） |
| **Won't Have** | 多用户权限管理 | MVP 单机使用 |

### 6.2 信息架构

```
6SPC 智能质量分析系统
├── 首页（上传界面）
│   ├── 快速开始指南
│   └── 拖拽上传区域
│
├── 处理页面
│   ├── 左侧：原始扫描件预览
│   ├── 中间：数据编辑器
│   └── 右侧：实时统计摘要
│
├── 分析页面
│   ├── 三图基础分析
│   │   ├── 单值读数图
│   │   ├── X-bar 控制图
│   │   └── R-控制图
│   └── 完整 6 SPC 分析（V2）
│       ├── 直方图
│       ├── 正态概率图
│       └── 能力图
│
└── 报告页面
    ├── HTML 预览
    ├── 批准操作
    └── 导出（PDF V2）
```

---

## 7. 用户流程描述

### 7.1 核心流程：从扫描件到报告

```
┌─────────────────────────────────────────────────────────────┐
│                     主流程（Happy Path）                      │
└─────────────────────────────────────────────────────────────┘

1. [质量工程师] 登录系统
   ↓
2. [质量工程师] 拖拽上传检验记录扫描件（PDF）
   ↓
3. [系统] 显示"AI 正在处理..."进度条
   ↓
4. [系统] 完成识别，显示提取结果
   ↓
5. [质量工程师] 检查数据表格，修正 OCR 错误
   ↓
6. [系统] 实时更新 Cpk/Pp 等统计量
   ↓
7. [质量工程师] 切换到"分析"标签页，查看 6 个图表
   ↓
8. [质量工程师] 确认数据无误，点击"预览报告"
   ↓
9. [系统] 生成 HTML 报告预览
   ↓
10. [质量工程师] 点击"批准并归档"
    ↓
11. [系统] 保存报告记录，生成唯一编号
    ↓
12. [质量工程师] 下载 HTML 报告（或打印存档）
```

### 7.2 异常流程

**异常 A：OCR 识别率低**
- 系统提示："识别完整度 60%，建议手动补全数据"
- 用户手动补充缺失数据点

**异常 B：Cpk 不合格（<1.33）**
- 系统高亮显示红色 "FAIL"
- 提示："Cpk 低于 1.33，请联系质量主管评估"
- 用户仍可批准报告（由质量工程师判断）

**异常 C：数据非正态分布**
- 系统显示警告："数据可能不符合正态分布（Shapiro-Wilk p < 0.05）"
- 提示："Cpk/Cp 指数可能不准确，建议使用非参数方法"

---

## 8. 非功能需求

### 8.1 性能要求（MVP 阶段宽松）

| 场景 | 响应时间目标 | 备注 |
|-----|-------------|------|
| 单批次处理（50 数据点） | < 60 秒（含 OCR） | OCR 时间占大头（~30s） |
| 数据编辑后统计刷新 | < 1 秒 | 用户无感知延迟 |
| 图表渲染 | < 2 秒 | 使用 Plotly 缓存 |
| HTML 报告生成 | < 3 秒 | Jinja2 模板渲染 |

**V2 优化目标**（非 MVP 范围）：
- 支持并发处理多个批次
- 缓存常用数据（如规格限）
- 数据库索引优化历史查询

### 8.2 可用性要求

- **易学性**：新用户在 10 分钟内完成首次报告（无需培训）
- **容错性**：支持撤销操作（Undo），避免误操作无法挽回
- **可访问性**：支持键盘快捷键（Ctrl+S 保存、Ctrl+Z 撤销）

### 8.3 兼容性要求

- **浏览器**：Chrome 90+、Edge 90+、Safari 14+
- **操作系统**：Windows 10/11、macOS 11+
- **屏幕分辨率**：最低 1366x768，推荐 1920x1080

### 8.4 安全性要求（MVP 基础）

- **API 密钥管理**：MinerU Token 存储在 `.env` 文件，不提交到 Git
- **数据隐私**：不上传用户数据到第三方云（除 OCR API）
- **输入验证**：防止 SQL 注入、XSS 攻击

### 8.5 可维护性要求

- **代码注释**：核心统计函数必须有中文注释说明统计原理
- **错误日志**：记录所有异常（OCR 失败、计算错误）
- **版本管理**：使用 Git，遵循语义化版本（Semantic Versioning）

---

## 9. 数据指标

### 9.1 业务指标（Business Metrics）

| 指标 | 计算方式 | 目标值 |
|-----|---------|-------|
| 日均处理批次数 | 每日生成的报告数 | ≥50 批次 |
| 用户活跃度 | DAU / MAU | ≥60% |
| 报告批准率 | 批准报告数 / 生成报告数 | ≥95% |
| OCR 编辑率 | 需要人工编辑的报告占比 | ≤30% |

### 9.2 产品指标（Product Metrics）

| 指标 | 计算方式 | 目标值 |
|-----|---------|-------|
| 识别准确率 | 正确识别数据点 / 总数据点 | ≥90% |
| 计算准确率 | 抽验统计量正确性 | 100% |
| 页面加载时间 | 首页完全加载时间 | <3 秒 |
| 崩溃率 | 系统异常退出次数 / 使用次数 | <0.1% |

### 9.3 统计学指标（Statistical Metrics）

| 指标 | 说明 | 验证方法 |
|-----|------|---------|
| Cp/Cpk 计算准确性 | 符合 ASTM E2281 标准 | 与 Minitab 对比验证 |
| 正态性检验准确性 | Shapiro-Wilk p 值计算 | 与 scipy 结果对比 |
| 控制限计算准确性 | X-bar/R 图 UCL/LCL | 手工计算验证 |

---

## 10. 风险与依赖

### 10.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|-----|------|------|---------|
| MinerU API 不稳定 | 高 | 中 | 1. 实现重试机制 2. 优雅降级到模拟数据 3. 备选 OCR 方案（Tesseract） |
| 统计计算错误 | 高 | 低 | 1. 单元测试覆盖 2. 与 Minitab 交叉验证 3. 代码 Review |
| 性能瓶颈 | 中 | 低 | 1. 异步处理 OCR 2. 前端缓存 3. V2 优化 |

### 10.2 业务风险

| 风险 | 影响 | 概率 | 缓解措施 |
|-----|------|------|---------|
| 用户不接受 AI 识别结果 | 高 | 高 | 1. 强调"人机协作"而非全自动 2. 提供便捷编辑器 3. 逐步提升识别率 |
| 合规性争议 | 高 | 低 | 1. 咨询法规专家 2. 保留人工审核环节 3. 审计日志完善 |
| 竞品跟进 | 中 | 中 | 1. 快速迭代 2. 强化用户体验 3. 考虑开源策略 |

### 10.3 外部依赖

| 依赖 | 类型 | 风险等级 | 备选方案 |
|-----|------|---------|---------|
| MinerU API | OCR 服务 | 高 | Tesseract、Azure OCR、Google Vision API |
| Streamlit | UI 框架 | 低 | Flask + Vue.js（如需深度定制） |
| SciPy/NumPy | 统计计算 | 低 | 自实现（不推荐） |

---

## 11. 版本规划

### 11.1 MVP 版本（v1.0）- 当前开发

**时间线**：4 周

**核心功能**：
- ✅ OCR 数据提取（MinerU 集成）
- ✅ 交互式数据编辑器
- ✅ Cp/Cpk/Pp/Ppk 计算
- ✅ 3 图基础分析（单值图、X-bar、R-图）
- ✅ HTML 报告预览
- ✅ 异常值检测（3σ）
- ✅ OCR 智能修正（缺失小数点、单位剥离）
- ✅ 实时正态性检验

**不做**：
- ❌ PDF 导出
- ❌ 电子签名
- ❌ 历史记录查询
- ❌ 用户权限管理

---

### 11.2 V1.5 版本 - 增强版

**时间线**：MVP 后 2-3 个月

**新增功能**：
- 📊 完整 6 SPC 图表（直方图、正态概率图、能力图）
- 📁 历史记录查询
- 📤 Excel 数据导出
- 🎨 多报告模板管理
- 🔔 邮件通知（报告生成后发送给主管）

---

### 11.3 V2.0 版本 - 专业版

**时间线**：V1.5 后 3-6 个月

**新增功能**：
- 📄 PDF 导出（符合 FDA 21 CFR Part 11）
- ✍️ 电子签名集成
- 👥 多用户权限管理（管理员、工程师、只读）
- 🔗 ERP 系统集成（自动获取批次信息）
- 📈 高级统计（非参数方法、Box-Cox 变换）
- 🌐 多语言支持（英文、日文）

---

## 12. 验收标准

### 12.1 功能验收

**场景 1：标准批次处理**
```
Given: 50 个测量点的检验记录扫描件
When: 质量工程师上传扫描件
Then:
  - 系统在 60 秒内完成识别
  - 识别准确率 ≥90%
  - Cpk 计算结果与 Minitab 一致（误差 <0.01）
  - 3 个图表正确渲染
  - HTML 报告包含所有必需信息
```

**场景 2：OCR 识别错误修正**
```
Given: OCR 识别结果包含错误（如 `102` 应为 `10.2`）
When: 质量工程师编辑数据
Then:
  - 统计量在 1 秒内更新
  - 图表自动刷新
  - 支持撤销操作
```

**场景 3：不合格批次处理**
```
Given: 计算 Cpk = 0.98（<1.33）
When: 质量工程师查看报告
Then:
  - Cpk 显示为红色 "FAIL"
  - 系统提示联系质量主管
  - 仍可批准报告（由用户判断）
```

### 12.2 性能验收

- **50 数据点批次处理**：<60 秒（端到端）
- **统计计算响应**：<1 秒（数据编辑后）
- **图表渲染**：<2 秒（3 个图表）

### 12.3 兼容性验收

- **Chrome 浏览器**：v90+ 通过
- **Windows/macOS**：主流版本通过
- **移动端**：不要求（MVP 仅桌面端）

---

## 13. 附录

### 13.1 术语表

| 术语 | 英文 | 解释 |
|-----|------|------|
| 6SPC | Six Sigma Statistical Process Control | 六西格玛统计过程控制 |
| Cp/Cpk | Process Capability Index | 过程能力指数（潜在能力） |
| Pp/Ppk | Process Performance Index | 过程性能指数（整体性能） |
| USL/LSL | Upper/Lower Specification Limit | 上/下规格限 |
| X-bar/R Chart | Mean and Range Control Chart | 均值-极差控制图 |
| OCR | Optical Character Recognition | 光学字符识别 |
| IQC | Incoming Quality Control | 进料检验 |
| ISO 13485 | International Organization for Standardization 13485 | 医疗器械质量管理体系标准 |

### 13.2 统计学公式参考

**Cp（潜在能力）**：
```
Cp = (USL - LSL) / (6σ_within)
```

**Cpk（最小潜在能力）**：
```
Cpk = min[(USL - μ) / (3σ_within), (μ - LSL) / (3σ_within)]
```

**Pp（整体性能）**：
```
Pp = (USL - LSL) / (6σ_overall)
```

**Ppk（最小整体性能）**：
```
Ppk = min[(USL - μ) / (3σ_overall), (μ - LSL) / (3σ_overall)]
```

其中：
- `USL/LSL`：上/下规格限
- `μ`：过程均值
- `σ_within`：子组内标准差（使用 R-bar/d2 估计）
- `σ_overall`：整体标准差（使用所有数据计算）

### 13.3 参考资料

- **ISO 13485:2016**：Medical devices - Quality management systems
- **FDA 21 CFR Part 11**：Electronic Records; Electronic Signatures
- **ASTM E2281**：Standard Practice for Process Capability Measurement
- **AIAG Statistical Process Control (SPC) Reference Manual**

---

## 14. 变更历史

| 版本 | 日期 | 作者 | 变更说明 |
|-----|------|------|---------|
| v1.0 | 2025-02-22 | Claude Code | 初始版本，MVP 范围定义 |

---

**文档结束**
